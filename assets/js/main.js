
function goSearch(e){ if(e){ e.preventDefault(); } const q = document.getElementById('q')?.value||''; if(q.trim()) window.location.href = 'search.html?q='+encodeURIComponent(q.trim()); return false; }
document.getElementById('burger')?.addEventListener('click', ()=> document.getElementById('nav')?.classList.toggle('open'));
function revealOnScroll(){ const els=document.querySelectorAll('.reveal'); const io=new IntersectionObserver(entries=>{ entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('show'); io.unobserve(e.target); } }); },{threshold:0.12}); els.forEach(el=>io.observe(el)); }
document.addEventListener('DOMContentLoaded', ()=>{ revealOnScroll(); loadHome(); loadFolk(); loadSpiritual(); loadAuthors(); loadShop(); loadNews(); loadAuthorDetail(); });
async function loadHome(){ const car=document.getElementById('carousel'); const homeNews=document.getElementById('homeNews'); if(car){ const folk=await (await fetch('data/folk.json')).json(); const sp=await (await fetch('data/spiritual.json')).json(); const items=[...folk,...sp]; items.forEach(it=>{ const card=document.createElement('div'); card.className='card reveal'; card.innerHTML=`<img src="${it.image}" alt=""><div class="body"><div class="title">${it.title}</div><div class="meta">${it.description||''}</div><div style="margin-top:8px;display:flex;gap:8px"><a class="btn-outline" href="${it.pdf}" download>Завантажити</a><button class="btn-outline" onclick="openPdf('${it.pdf}')">Переглянути</button></div></div>`; car.appendChild(card); }); document.getElementById('prev')?.addEventListener('click', ()=> car.scrollBy({left:-300,behavior:'smooth'})); document.getElementById('next')?.addEventListener('click', ()=> car.scrollBy({left:300,behavior:'smooth'})); } if(homeNews){ const news=await (await fetch('data/news.json')).json(); news.forEach(n=>{ const div=document.createElement('a'); div.href=n.url; div.className='news-item reveal'; div.innerHTML=`<div class="title">${n.title}</div><div class="meta">${n.date}</div><p class="muted">${n.excerpt}</p>`; homeNews.appendChild(div); }); } }
async function loadFolk(){ const wrap=document.getElementById('folkList'); if(!wrap) return; const items=await (await fetch('data/folk.json')).json(); items.forEach(it=>{ const pair=document.createElement('div'); pair.className='pair reveal'; pair.innerHTML=`<div><div class="thumb"><img src="${it.image}" alt=""></div><div class="body"><div class="title">${it.title}</div><div class="meta">${it.description||''}</div><div style="margin-top:6px;display:flex;gap:8px"><button class="btn-outline" onclick="openPdf('${it.pdf}')">Переглянути</button><a class="btn-outline" href="${it.pdf}" download>Завантажити</a></div></div></div><div><div class="thumb"><img src="${it.image}" alt=""></div><div class="body"><div class="title">${it.title} (варіант)</div><div class="meta">Альтернативна редакція</div><div style="margin-top:6px;display:flex;gap:8px"><button class="btn-outline" onclick="openPdf('${it.pdf}')">Переглянути</button><a class="btn-outline" href="${it.pdf}" download>Завантажити</a></div></div></div>`; wrap.appendChild(pair); }); }
async function loadSpiritual(){ const wrap=document.getElementById('spList'); if(!wrap) return; const items=await (await fetch('data/spiritual.json')).json(); items.forEach(it=>{ const card=document.createElement('div'); card.className='card reveal'; card.innerHTML=`<img src="${it.image}" alt=""><div class="body"><div class="title">${it.title}</div><div class="meta">${it.description||''}</div><div style="margin-top:8px;display:flex;gap:8px"><button class="btn-outline" onclick="openPdf('${it.pdf}')">Переглянути</button><a class="btn-outline" href="${it.pdf}" download>Завантажити</a></div></div>`; wrap.appendChild(card); }); }
async function loadAuthors(){ const wrap=document.getElementById('authorsList'); if(!wrap) return; const items=await (await fetch('data/authors.json')).json(); items.forEach(a=>{ const row=document.createElement('div'); row.className='card reveal'; row.innerHTML=`<div class="body" style="display:flex;gap:12px;align-items:center"><img src="${a.photo}" alt="" style="width:64px;height:64px;border-radius:12px;object-fit:cover"><div style="flex:1"><div class="title">${a.name}</div><div class="meta">${a.bio}</div></div><a class="btn-outline" href="author.html?slug=${a.slug}">Переглянути</a></div>`; wrap.appendChild(row); }); }
async function loadAuthorDetail(){ const box=document.getElementById('authorDetail'); if(!box) return; const params=new URLSearchParams(location.search); const slug=params.get('slug'); const items=await (await fetch('data/authors.json')).json(); const a=items.find(x=>x.slug===slug) || items[0]; box.innerHTML=`<div class="card" style="overflow:hidden"><div class="body" style="display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap"><img src="${a.photo}" alt="" style="width:120px;height:120px;border-radius:16px;object-fit:cover"><div style="flex:1;min-width:240px"><h1 style="margin:0">${a.name}</h1><p class="muted">${a.bio}</p></div></div></div>`; a.works.forEach(w=>{ const pair=document.createElement('div'); pair.className='pair reveal'; pair.style.marginTop='12px'; pair.innerHTML=`<div class="card"><div class="body"><div class="title">${w.title} — стара</div><div style="display:flex;gap:8px;margin-top:6px"><button class="btn-outline" onclick="openPdf('${w.old}')">Переглянути</button><a class="btn-outline" href="${w.old}" download>Завантажити</a></div></div></div><div class="card"><div class="body"><div class="title">${w.title} — нова</div><div style="display:flex;gap:8px;margin-top:6px"><button class="btn-outline" onclick="openPdf('${w.new}')">Переглянути</button><a class="btn-outline" href="${w.new}" download>Завантажити</a></div></div></div>`; box.appendChild(pair); if(w.youtube){ const yt=document.createElement('div'); yt.className='reveal'; yt.style.marginTop='8px'; yt.innerHTML=`<div class="card"><div class="body"><div class="title">Приклад виконання</div><div class="meta">YouTube</div><div style="position:relative;padding-top:56.25%"><iframe src="${w.youtube}" title="YouTube" style="position:absolute;inset:0;width:100%;height:100%;border:0;border-radius:12px" allowfullscreen></iframe></div></div></div>`; box.appendChild(yt); } }); }
async function loadShop(){ const wrap=document.getElementById('shopList'); if(!wrap) return; const items=await (await fetch('data/shop.json')).json(); items.forEach(it=>{ const card=document.createElement('div'); card.className='card reveal'; card.innerHTML=`<img src="${it.image}" alt=""><div class="body"><div class="title">${it.title}</div><div class="meta">${it.price}</div><div style="margin-top:8px;display:flex;gap:8px"><button class="btn-outline" onclick="openPdf('${it.pdf}')">Переглянути</button><a class="btn-outline" href="${it.pdf}" download>Купити/Завантажити</a></div></div>`; wrap.appendChild(card); }); }
async function loadNews(){ const wrap=document.getElementById('newsList'); if(!wrap) return; const items=await (await fetch('data/news.json')).json(); items.forEach(n=>{ const item=document.createElement('a'); item.href=n.url; item.className='news-item reveal'; item.innerHTML=`<div class="title">${n.title}</div><div class="meta">${n.date}</div><p class="muted">${n.excerpt}</p>`; wrap.appendChild(item); }); }
function openPdf(url){ const modal=document.getElementById('pdfModal'); if(modal){ window._pdfUrl=url; window.showPdf(); } else { window.open(url,'_blank'); } }
