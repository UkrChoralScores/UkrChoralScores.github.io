
async function runSearch(){ const params=new URLSearchParams(location.search); const q=(params.get('q')||'').toLowerCase(); const box=document.getElementById('searchResults'); const datasets=await Promise.all([fetch('data/folk.json').then(r=>r.json()),fetch('data/spiritual.json').then(r=>r.json()),fetch('data/authors.json').then(r=>r.json()),fetch('data/news.json').then(r=>r.json())]); const [folk,sp,authors,news]=datasets; let results=[]; results=results.concat(folk.filter(x=>x.title.toLowerCase().includes(q)).map(x=>({type:'Партитура (Народні)',...x}))); results=results.concat(sp.filter(x=>x.title.toLowerCase().includes(q)).map(x=>({type:'Партитура (Духовні)',...x}))); results=results.concat(authors.filter(x=>x.name.toLowerCase().includes(q)).map(x=>({type:'Композитор',title:x.name,image:x.photo,pdf:null,link:`author.html?slug=${x.slug}`}))); results=results.concat(news.filter(x=>x.title.toLowerCase().includes(q)).map(x=>({type:'Новина',title:x.title,link:x.url}))); if(!results.length){ box.innerHTML=`<p class='muted'>Нічого не знайдено за запитом “${q}”.</p>`; return; } results.forEach(r=>{ const card=document.createElement('div'); card.className='card'; let actions=''; if(r.pdf){ actions=`<div style="margin-top:8px;display:flex;gap:8px"><button class="btn-outline" onclick="openPdf('${r.pdf}')">Переглянути</button><a class="btn-outline" href="${r.pdf}" download>Завантажити</a></div>`; } let link=r.link?`<a class="btn-outline" href="${r.link}">Відкрити</a>`:''; card.innerHTML=`<img src="${r.image||'uploads/cover_1.png'}" alt=""><div class="body"><div class="meta">${r.type}</div><div class="title">${r.title}</div>${actions}${link}</div>`; box.appendChild(card); }); }
document.addEventListener('DOMContentLoaded',runSearch);
